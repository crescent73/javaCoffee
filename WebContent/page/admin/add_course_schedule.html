<!DOCTYPE html>
<html lang="en">

<head>
    <title>Add Course Schedule</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="../plugins/fontawesome-free/css/all.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../dist/css/adminlte.min.css">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    <!-- 引用vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <!-- Select2 -->
    <link rel="stylesheet" href="../plugins/select2/css/select2.min.css">
    <link rel="stylesheet" href="../plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">

</head>

<body  style="background-color: #f4f6f9">
<div class="content" id="content">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0 text-dark">选课管理</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="home.html">主页</a></li>
                        <li class="breadcrumb-item active">添加选课</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    <div class="content">
        <div class="card card-default">
            <div class="card-header">
                <h3 class="card-title">为课程添加学生</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-remove"></i></button>
                </div>
            </div>

            <div class="card-body">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="for_course_course">课程</label>
                        <select type="text" class="form-control select2" id="for_course_course" data-placeholder="选择课程">

                        </select>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="for_course_student">选课学生</label>
                        <select type="text" class="form-control select2" id="for_course_student" data-placeholder="选择学生" multiple>

                        </select>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <button type="submit" class="btn btn-primary" @click="on_submit(1)">Submit</button>
            </div>

        </div>
        <div class="card card-default">
            <div class="card-header">
                <h3 class="card-title">为学生添加课程</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-remove"></i></button>
                </div>
            </div>

            <div class="card-body">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="for_student_student">学生</label>
                        <select type="text" class="form-control select2" id="for_student_student" data-placeholder="选择学生">
                        </select>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="for_student_course">选课课程</label>
                        <select type="text" class="form-control select2" id="for_student_course" data-placeholder="选择课程" multiple>

                        </select>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <button type="submit" class="btn btn-primary" @click="on_submit(2)">Submit</button>
            </div>

        </div>

    </div>

</div>


</body>
<!-- jQuery -->
<script src="../plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/adminlte.min.js"></script>
<!-- Select2 -->
<script src="../plugins/select2/js/select2.full.min.js"></script>

<script>
    $(document).ready(function() {
        $("#for_course_course").select2({
            theme: 'bootstrap4',
            ajax: {
                delay: 500,
                type: 'post',
                url: '/blackboard/system/searchCourseByKey',
                data: function (params) {
                    return {
                        key: params.term
                    };
                },
                processResults: function (data, params) {
                    if(data.code === "208") {
                        var courses = data.data.data;
                        var list = [];
                        courses.forEach(function (course) {
                            var option = {
                                id: "",
                                text: "",
                            };
                            option.id = course.id;
                            option.text = course.courseNumber + " " + course.courseName;
                            list.push(option);
                        });
                        return {
                            results: list
                        }
                    }
                    return {
                        results: []
                    };
                },
                cache: true
            },
            language: {
                noResults: function (params) {
                    return "没有找到，请确认课程名或课程号。"
                },
                searching: function () {
                    return '搜索中...';
                }
            }
        });
        $("#for_student_course").select2({
            theme: 'bootstrap4',
            ajax: {
                delay: 500,
                type: 'post',
                url: '/blackboard/system/searchCourseByKey',
                data: function (params) {
                    return {
                        key: params.term
                    };
                },
                processResults: function (data, params) {
                    if(data.code === "208") {
                        var courses = data.data.data;
                        var list = [];
                        courses.forEach(function (course) {
                            var option = {
                                id: "",
                                text: "",
                            };
                            option.id = course.id;
                            option.text = course.courseNumber + " " + course.courseName;
                            list.push(option);
                        });
                        return {
                            results: list
                        }
                    }
                    return {
                        results: []
                    };
                },
                cache: true
            },
            language: {
                noResults: function (params) {
                    return "没有找到，请确认课程名或课程号。"
                },
                searching: function () {
                    return '搜索中...';
                }
            }
        });
        $("#for_student_student").select2({
            theme: 'bootstrap4',
            ajax: {
                delay: 500,
                type: 'post',
                url: '/blackboard/system/searchStudentByKey',
                data: function (params) {
                    return {
                        key: params.term
                    };
                },
                processResults: function (data, params) {
                    if(data.code === "208") {
                        var students = data.data.data;
                        var list = [];
                        students.forEach(function (student) {
                            var option = {
                                id: "",
                                text: "",
                            };
                            option.id = student.id;
                            option.text = student.studentNumber + " " + student.studentName;
                            list.push(option);
                        });
                        return {
                            results: list
                        }
                    }
                    return {
                        results: []
                    };
                },
                cache: true
            },
            language: {
                noResults: function (params) {
                    return "没有找到，请确认学生姓名或学号。"
                },
                searching: function () {
                    return '搜索中...';
                }
            }
        });
        $("#for_course_student").select2({
            theme: 'bootstrap4',
            ajax: {
                delay: 500,
                type: 'post',
                url: '/blackboard/system/searchStudentByKey',
                data: function (params) {
                    return {
                        key: params.term
                    };
                },
                processResults: function (data, params) {
                    if(data.code === "208") {
                        var students = data.data.data;
                        var list = [];
                        students.forEach(function (student) {
                            var option = {
                                id: "",
                                text: "",
                            };
                            option.id = student.id;
                            option.text = student.studentNumber + " " + student.studentName;
                            list.push(option);
                        });
                        return {
                            results: list
                        }
                    }
                    return {
                        results: []
                    };
                },
                cache: true
            },
            language: {
                noResults: function (params) {
                    return "没有找到，请确认学生姓名或学号。"
                },
                searching: function () {
                    return '搜索中...';
                }
            }
        });
    });

    var vue = new Vue({
        el: "#content",
        data: {
            form_for_course: {
                studentList: [],
                courseId: 0
            },
            form_for_student: {
                studentId: 0,
                courseList: [],
            }
        },
        methods: {
            on_submit: function (index) {
                let self = this;
                if(index === 1) {
                    $("#for_course_course option:selected").each(function () {
                        self.form_for_course.courseId = this.val();
                    });
                    $("#for_course_student option:selected").each(function () {
                        self.form_for_course.studentId.push(this.val());
                    });
                    if(self.form_for_course.courseId === undefined || self.form_for_course.studentList.length === 0) {
                        alert("选课课程和学生不能为空！");
                        return;
                    }
                    $.ajax({
                        type:"post",
                        url: "/blackboard/admin/addCourseSchedule",
                        data: self.form_for_course,
                        success: function (res) {
                            if(res.code === "202") {
                                alert("添加成功！");
                                window.location.href = "/blackboard/page/admin/add_course_schedule";
                            } else {
                                alert("添加失败！");
                            }
                        },
                        error: function (res) {
                            console.log(res);
                            alert("添加失败！");
                        }
                    })

                } else if (index === 2) {
                    $("#for_student_student option:selected").each(function () {
                        self.form_for_student.studentId = this.val();
                    });
                    $("#for_student_course option:selected").each(function () {
                        self.form_for_student.courseId.push(this.val());
                    });
                    if(self.form_for_student.studentId === undefined || self.form_for_student.courseList.length === 0) {
                        alert("选课课程和学生不能为空！");
                        return;
                    }
                    $.ajax({
                        type:"post",
                        url: "/blackboard/admin/addCourseSchedule",
                        data: self.form_for_student,
                        success: function (res) {
                            if(res.code === "202") {
                                alert("添加成功！");
                                window.location.href = "/blackboard/page/admin/add_course_schedule";
                            } else {
                                alert("添加失败！");
                            }
                        },
                        error: function (res) {
                            console.log(res);
                            alert("添加失败！");
                        }
                    })
                }
            },
        }
    })
</script>
</html>